/*! 
 * db-grid
 * Lightweight angular grid
 * @version 1.1.12 
 * 
 * Copyright (c) 2018 David Benson, Steve Gentile 
 * @link https://github.com/SMARTDATASYSTEMSLLC/db-grid 
 * @license  MIT 
 */

angular.module("db-grid",[]),function(){"use strict";function a(){return function(a){return a.toLowerCase().replace(/ (\w)/g,function(a,b){return b.toUpperCase()})}}angular.module("db-grid").filter("camelCase",a)}(),function(){"use strict";function a(a){function b(a,b){if(b.filter)switch(b.type){case"date":var c=b.filter.split("-"),d=new Date(c[0]),e=new Date(c[1]||d.valueOf()+864e5);isNaN(d)||isNaN(e)||a.push({filter:[d.valueOf(),e.valueOf()],key:b.key,type:b.type});break;case"number":case"int":var f=b.filter.split("-");!f[0]&&f[1]&&(f.shift(),f[0]*=-1),!f[1]&&f[2]&&(f.splice(1,1),f[1]*=-1),""===f[1]&&(f[1]=Number.MAX_VALUE);var g=parseFloat(f[0]),h=parseFloat(f[1]||f[0]);a.push({filter:[g,h],key:b.key,type:"number"});break;case"boolean":case"bool":/^(0|(false)|(no)|n|f)$/i.test(b.filter)||/^([1-9]\d*|(true)|(yes)|y|t)$/i.test(b.filter)?a.push({filter:/^([1-9]\d*|(true)|(yes)|y|t)$/i.test(b.filter),key:b.key,type:"bool"}):(b.trueFilter&&b.falseFilter&&b.filter.toLowerCase()===b.trueFilter||b.filter.toLowerCase()===b.falseFilter.toLowerCase())&&a.push({filter:b.filter.toLowerCase()===b.trueFilter.toLowerCase(),key:b.key,type:"bool"});break;default:"string"==typeof b.filter&&"<>"===b.filter.substr(0,2)?a.push({filter:b.filter.substr(2).toLowerCase().trim(),key:b.key,negated:!0}):"string"==typeof b.filter&&a.push({filter:b.filter.toLowerCase().trim(),key:b.key})}return a}function c(a,b){for(var c=b.split(".");c.length&&(a=a[c.shift()]););return a}return function(d,e){if("string"==typeof e)return a("filter")(d,e);var f=[];return Array.isArray(e)&&(f=e.reduce(b,[])),a("filter")(d,function(a){for(var b=-1,d=f.length;++b<d;){var e=f[b];if(e.key){if(!e.type&&angular.isObject(c(a,e.key))&&e.filter.length>=2&&!e.negated&&-1===JSON.stringify(c(a,e.key)).toLowerCase().indexOf(e.filter)||!e.type&&angular.isObject(c(a,e.key))&&e.filter.length>=2&&e.negated&&JSON.stringify(c(a,e.key)).toLowerCase().indexOf(e.filter)>-1||!e.type&&!e.negated&&-1===(c(a,e.key)+"").toLowerCase().indexOf(e.filter)||!e.type&&e.negated&&(c(a,e.key)+"").toLowerCase().indexOf(e.filter)>-1||"bool"===e.type&&Boolean(c(a,e.key))!==e.filter||"number"===e.type&&(c(a,e.key)<e.filter[0]||c(a,e.key)>e.filter[1]))return!1;if("date"===e.type){var g=new Date(c(a,e.key)).valueOf();if(g<e.filter[0]||g>e.filter[1])return!1}}}return!0})}}a.$inject=["$filter"],angular.module("db-grid").filter("complexFilter",a)}(),function(){"use strict";function a(){return function(a){return(null===a||void 0===a||""===a)&&(a=" "),a=(a+"").replace(/([A-Z])/g," $1"),a[0].toUpperCase()+a.slice(1)}}angular.module("db-grid").filter("labelCase",a)}(),function(){"use strict";function a(){return function(a,b,c){return a&&a.length?(b=parseInt(b||0,10)||0,c=parseInt(c||0,10),c||(c=25),a.slice(b*c,(b+1)*c)):[]}}angular.module("db-grid").filter("page",a)}(),function(){"use strict";function a(a){return{restrict:"A",link:function(b,c){if("function"==typeof b._col.template)c.append(b._col.template(b));else if(!c.html().trim()){var d=angular.element("<span>"+b._col.template+"</span>"),e=a(d);c.append(d),e(b),c.data("compiled",e)}b._col.colClass&&c.addClass(b._col.colClass)}}}a.$inject=["$compile"],angular.module("db-grid").directive("dbBindCell",a)}(),function(){"use strict";function a(a){return{restrict:"E",require:"^dbGrid",compile:function(b){var c=b.html().trim();return b.empty(),function(b,d,e,f){var g=null;!c&&e.key&&(c="{{"+f.rowName+"."+e.key+"}}"),g="true"===e.bind?c:a(c);var h={index:d.prevAll("db-col").length,filter:e.query,width:e.width,colClass:e.colClass,falseFilter:e.falseFilter||"",trueFilter:e.trueFilter||"",key:e.key,label:e.label,canSort:"false"===e.canSort?!1:!!e.key,type:e.type,title:e.title,bind:"true"===e.bind,template:g};f.addColumn(h),void 0!==e.query&&e.$observe("query",function(a,b){a!==b&&(a&&f.setAdvanced(!0),h.filter=a,f.refresh())}),b.$on("$destroy",function(){f.removeColumn(h)})}}}}a.$inject=["$interpolate"],angular.module("db-grid").directive("dbCol",a)}(),function(){"use strict";function a(a,b,c,d){return{restrict:"E",transclude:!0,scope:!0,templateUrl:"db-grid/table-directives/db-grid.html",compile:function(a,b){var c=b["for"].split(" ");if(1!==c.length&&"in"!==c[1])return void d.error("Invalid loop");var e=a.find("tbody").children();e.attr("ng-repeat",c[0]+" in _model.filteredItems");var f=b.rowClick;f&&e.attr("ng-click",f);var g=b.rowCss;g&&e.attr("ng-class",g)},controller:["$scope","$element","$attrs",function(d,e,f){function g(a,b,e,f,g){if(d._model.items){var h=r(d._model.items,a);return b&&(h=s(h,b,!e)),d._model.total=h?h.length:0,c.when(t(h,f,g))}return c.when(null)}function h(a){d._model.sort===a?d._model.sortAsc=!d._model.sortAsc:d._model.sort=a,p(),d._model.refresh()}function i(){angular.forEach(d._model.cols,function(a){a.filter=""}),p(),d._model.refresh()}function j(a){return a.title?a.title:"bool"===a.type&&a.trueFilter&&a.falseFilter?"Filter using "+a.trueFilter+" and "+a.falseFilter:"bool"===a.type?"Filter using yes, no, true, or false":a.type?"Use a dash (-) to specify a range":void 0}function k(){for(var a=[],b=1;b<=d._model.total/d._model.pageSize+1;b++)b>d._model.currentPage-5&&b<d._model.currentPage+5&&a.push(b);return a}function l(a){d._model.currentPage=a,p(),o()}function m(a){d.$grid.noResetRefreshFlag||a===!1?d.$grid.noResetRefreshFlag=!1:(d._model.currentPage=1,d._model.isApi&&(d._model.filteredItems=null)),o()}function n(){d._model.currentPage=1,p(),o()}function o(){!d._model.placeLoaded&&(d._model.items&&d._model.items.length||d._model.isApi)&&(q(),d._model.placeLoaded=!0),d._model.getItems(d._model.showAdvancedFilter?d._model.cols:d._model.filterText,null!==d._model.sort?(d._model.cols[d._model.sort]||{}).key:null,d._model.sortAsc,d._model.currentPage-1,d._model.pageSize,d._model.cols).then(function(a){d._model.filteredItems=a})}function p(){d._model.savePlace&&window.sessionStorage.setItem(f.id||"true"!==f.savePlace.toLowerCase()?f.savePlace:f["for"],JSON.stringify({filterText:d._model.filterText,showAdvancedFilter:d._model.showAdvancedFilter,sort:d._model.sort,sortAsc:d._model.sortAsc,currentPage:d._model.currentPage,filters:d._model.cols.map(function(a){return a.filter})}))}function q(){if(d._model.savePlace){var a=JSON.parse(window.sessionStorage.getItem(f.id||"true"!==f.savePlace.toLowerCase()?f.savePlace:f["for"]));a&&a.currentPage&&(d._model.filterText=a.filterText,d._model.showAdvancedFilter=a.showAdvancedFilter,d._model.sort=a.sort,d._model.sortAsc=a.sortAsc,d._model.currentPage=a.currentPage,angular.forEach(a.filters,function(a,b){d._model.cols[b].filter=a}))}}var r=a("complexFilter"),s=a("orderBy"),t=a("page"),u=function(a,b){var c,d=function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)};return d.cancel=function(){clearTimeout(c)},d};d._model={isApi:!1,toolbarHtml:f.toolbarHtml||"db-grid/table-directives/db-grid-toolbar.html",label:f.label,tableClass:f.tableClass,pagingLayout:f.pagingLayout||"bottom",currentPage:1,total:0,sortAsc:f.sort?"-"!==f.sort[0]:!0,sort:null,filterText:null,showAdvancedFilter:!1,pageSize:f.pageSize?parseInt(f.pageSize,10):25,filterType:(f.filter||"advanced").toLowerCase(),cols:[],savePlace:f.savePlace,placeLoaded:!1,items:null,filteredItems:null,getTooltip:j,getItems:g,toggleSort:h,clearFilters:i,getPages:k,setPage:l,refreshFilter:u(n,100),refresh:u(o,100),waiting:!1},d.$grid={refresh:u(m,100),items:function(){return d._model.filteredItems},noResetRefreshFlag:!1};var v=f["for"].split(" ");this.rowName=v[0],v[2]&&d.$watchCollection(v.slice(2).join(" "),function(a){d.$grid.noResetRefreshFlag?d.$grid.noResetRefreshFlag=!1:d._model.currentPage=1,d._model.filteredItems=null,d._model.items=a,d._model.refresh()}),this.addColumn=function(a){var b=f.sort||"";("-"===b[0]||"+"===b[0])&&(b=b.slice(1)),b&&b===a.key&&null===d._model.sort?(d._model.sort=d._model.cols.length,d._model.refresh()):null!==d._model.sort&&d._model.sort>=a.index&&(d._model.sort+=1),a.filter&&(d._model.showAdvancedFilter=!0),d._model.cols.splice(a.index,0,a)},this.removeColumn=function(a){var b=d._model.cols.indexOf(a);b>-1&&(d._model.cols.splice(b,1),d._model.sort>=b&&(d._model.sort-=1,-1===d._model.sort&&(d._model.sort=null)))},this.setDataSource=function(a){b(function(){d._model.getItems=a,d._model.isApi=!0,d._model.refresh.cancel(),d.$grid.refresh.cancel(),d._model.refresh=u(o,1e3),d.$grid.refresh=u(m,1e3),o()})},this.setTotal=function(a){d._model.total=a},this.setWaiting=function(a){d._model.waiting=a},this.setAdvanced=function(a){d._model.showAdvancedFilter=a},this.refresh=function(a){(d._model.items||a)&&m()},void 0!==f.query&&f.$observe("query",function(a,b){a&&a!==b&&(angular.isString(a)&&(d._model.filterText=a),d._model.placeLoaded=!0,d._model.refresh())})}]}}a.$inject=["$filter","$timeout","$q","$log"],angular.module("db-grid").directive("dbGrid",a)}(),function(){"use strict";function a(){return{restrict:"EA",link:function(a,b,c,d,e){e(function(c,d){b.empty(),d.$grid=a.$grid,b.append(c)})}}}angular.module("db-grid").directive("dbTransclude",a)}(),function(){"use strict";function a(){return{restrict:"A",require:["ngModel","^?form"],link:function(a,b,c,d){d[1]&&d[1].$removeControl(d[0]);var e={$addControl:angular.noop,$removeControl:angular.noop,$setValidity:function(){},$setDirty:function(){b.removeClass("ng-pristine").addClass("ng-dirty"),d[0].$dirty=!0,d[0].$pristine=!1},$setPristine:function(){b.removeClass("ng-dirty").addClass("ng-pristine"),d[0].$dirty=!1,d[0].$pristine=!0}};angular.extend(d[0],e)}}}angular.module("db-grid").directive("isolateControl",a)}(),angular.module("db-grid").run(["$templateCache",function(a){"use strict";a.put("db-grid/table-directives/db-grid-toolbar.html",'<a ng-if="_model.showAdvancedFilter" href="" class="btn btn-default" ng-click="_model.clearFilters()">Clear All Filters <span class="big-x">&times;</span></a> <div ng-if="!_model.showAdvancedFilter && _model.filterType !== \'none\'" class="toolbar-input"> <div class="form-group has-feedback"> <input class="form-control" type="text" ng-model="_model.filterText" ng-keyup="_model.refreshFilter()" placeholder="Filter {{_model.label || \'items\'}}" isolate-control> <a href="" ng-click="_model.filterText = \'\'; $grid.refresh()" class="form-control-feedback feedback-link">&times;</a> </div> </div> <a href="" ng-if="_model.filterType === \'advanced\'" class="btn btn-default" ng-class="{\'btn-primary\': _model.showAdvancedFilter}" ng-click="_model.showAdvancedFilter = !_model.showAdvancedFilter">{{_model.showAdvancedFilter ? \'Simple\' : \'Advanced\'}} Filtering</a>'),a.put("db-grid/table-directives/db-grid.html",'<div class="table-responsive db-grid"> <div class="btn-toolbar"> <ng-include src="_model.toolbarHtml"></ng-include> <db-transclude></db-transclude> <p ng-if="_model.total && _model.label"><i>{{_model.total}} {{_model.label}}</i></p> </div> <ul class="pagination" ng-if="_model.total > _model.pageSize && !_model.waiting && (_model.pagingLayout === \'both\' || _model.pagingLayout === \'top\')"> <li ng-if="_model.currentPage > 1"> <a href="" aria-label="First" ng-click="_model.setPage(1)"> <span aria-hidden="true">First</span> </a> </li> <li class="disabled" ng-if="_model.currentPage <= 1"> <a href="" aria-label="First"> <span aria-hidden="true">First</span> </a> </li> <li ng-if="_model.currentPage > 1"> <a href="" aria-label="Previous" ng-click="_model.setPage(_model.currentPage - 1)"> <span aria-hidden="true">&lt;</span> </a> </li> <li class="disabled" ng-if="_model.currentPage <= 1"> <a href="" aria-label="Previous"> <span aria-hidden="true">&lt;</span> </a> </li> <li ng-repeat="page in _model.getPages()" ng-class="{active: page === _model.currentPage}"> <a href="" ng-click="_model.setPage(page)">{{page}}</a> </li> <li ng-if="_model.currentPage < (_model.total / _model.pageSize)"> <a href="" aria-label="Next" ng-click="_model.setPage(_model.currentPage + 1)"> <span aria-hidden="true">&gt;</span> </a> </li> <li class="disabled" ng-if="_model.currentPage >= (_model.total / _model.pageSize)"> <a href="" aria-label="Next" class="disabled"> <span aria-hidden="true">&gt;</span> </a> </li> <li ng-if="_model.currentPage < (_model.total / _model.pageSize)"> <a href="" aria-label="Last" ng-click="_model.setPage(1 + (_model.total - (_model.total % _model.pageSize)) / _model.pageSize)"> <span aria-hidden="true">Last ({{1 + (_model.total - (_model.total % _model.pageSize)) / _model.pageSize}})</span> </a> </li> <li class="disabled" ng-if="_model.currentPage >= (_model.total / _model.pageSize)"> <a href="" aria-label="Last" class="disabled"> <span aria-hidden="true">Last ({{1 + (_model.total - (_model.total % _model.pageSize)) / _model.pageSize}})</span> </a> </li> </ul> <table class="table db-grid table-hover {{_model.tableClass}}"> <thead> <tr ng-if="_model.showAdvancedFilter"> <th ng-repeat="_col in _model.cols" ng-style="{width: _col.width}" class="{{_col.colClass}}"> <div ng-if="::_col.canSort"> <input type="text" class="form-control filter-input" ng-keyup="_model.refreshFilter()" ng-model="_col.filter" placeholder="Filter {{::_col.label || (_col.key | labelCase)}}" tooltip="{{_model.getTooltip(_col)}}" tooltip-trigger="focus" tooltip-placement="top" isolate-control> </div>   <tr> <th ng-repeat="_col in _model.cols" ng-style="{width: _col.width}" class="{{_col.colClass}}"> <a href="" ng-if="::_col.canSort" ng-click="_model.toggleSort($index)">{{::_col.label || (_col.key | labelCase) }}&nbsp;<i class="fa" style="display: inline" ng-class="{\n                         \'fa-sort\'     : _model.sort !== $index,\n                         \'fa-sort-down\': _model.sort === $index &&  _model.sortAsc,\n                         \'fa-sort-up\'  : _model.sort === $index && !_model.sortAsc\n                         }"></i> </a> <span ng-if="::!_col.canSort"> {{::_col.label || (_col.key | labelCase)}} </span>    <tbody ng-show="!_model.waiting"> <tr> <td ng-repeat="_col in _model.cols" db-bind-cell>   </table> <div ng-if="_model.filteredItems && _model.filteredItems.length === 0 && _model.label && !_model.waiting" class="db-summary"> No {{_model.label}}. </div> <ul class="pagination" ng-if="_model.total > _model.pageSize && !_model.waiting && (_model.pagingLayout === \'both\' || _model.pagingLayout === \'bottom\')"> <li ng-if="_model.currentPage > 1"> <a href="" aria-label="First" ng-click="_model.setPage(1)"> <span aria-hidden="true">First</span> </a> </li> <li class="disabled" ng-if="_model.currentPage <= 1"> <a href="" aria-label="First"> <span aria-hidden="true">First</span> </a> </li> <li ng-if="_model.currentPage > 1"> <a href="" aria-label="Previous" ng-click="_model.setPage(_model.currentPage - 1)"> <span aria-hidden="true">&lt;</span> </a> </li> <li class="disabled" ng-if="_model.currentPage <= 1"> <a href="" aria-label="Previous"> <span aria-hidden="true">&lt;</span> </a> </li> <li ng-repeat="page in _model.getPages()" ng-class="{active: page === _model.currentPage}"> <a href="" ng-click="_model.setPage(page)">{{page}}</a> </li> <li ng-if="_model.currentPage < (_model.total / _model.pageSize)"> <a href="" aria-label="Next" ng-click="_model.setPage(_model.currentPage + 1)"> <span aria-hidden="true">&gt;</span> </a> </li> <li class="disabled" ng-if="_model.currentPage >= (_model.total / _model.pageSize)"> <a href="" aria-label="Next" class="disabled"> <span aria-hidden="true">&gt;</span> </a> </li> <li ng-if="_model.currentPage < (_model.total / _model.pageSize)"> <a href="" aria-label="Last" ng-click="_model.setPage(1 + (_model.total - (_model.total % _model.pageSize)) / _model.pageSize)"> <span aria-hidden="true">Last ({{1 + (_model.total - (_model.total % _model.pageSize)) / _model.pageSize}})</span> </a> </li> <li class="disabled" ng-if="_model.currentPage >= (_model.total / _model.pageSize)"> <a href="" aria-label="Last" class="disabled"> <span aria-hidden="true">Last ({{1 + (_model.total - (_model.total % _model.pageSize)) / _model.pageSize}})</span> </a> </li> </ul> <div ng-show="_model.waiting"> <i class="fa fa-circle-o-notch fa-spin"></i> Please Wait... </div> </div>')}]);
//# sourceMappingURL=db-grid.min.js.map